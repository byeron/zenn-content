---
title: "import_roleå†…ã§å®Ÿè¡Œã—ãŸã‚¿ã‚¹ã‚¯ã®çµæœã‚’registerã§å–å¾—ã§ããªã„"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ansible"]
published: false
---

# èƒŒæ™¯
`import_role`ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸã‚¿ã‚¹ã‚¯ã®`changed`ã®æƒ…å ±ã‚’ã‚‚ã¨ã«å‡¦ç†ã‚’åˆ†å²ã•ã›ãŸã„

# å®Ÿè¡Œç’°å¢ƒ
- ansible 2.10.3

# `import_role`ã‚’ç”¨ã„ã¦ã€ç‰¹å®šã®ãƒ­ãƒ¼ãƒ«ã«å«ã¾ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹

ã¾ãš`import_role`ã‚’ç”¨ã„ã¦ãƒ­ãƒ¼ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‹ã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œã‚’è¡Œã†

å…¬å¼docã‚’ã‚‚ã¨ã«`myrole`ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ï¼ˆ`tasks/other.yaml`ï¼‰ã‚’å‘¼ã³å‡ºã™playbookã‚’ä½œæˆã™ã‚‹ï¼ˆ[å‚è€ƒ](https://docs.ansible.com/ansible/2.4/import_role_module.html#examples)ï¼‰
```
- name: Run tasks/other.yaml instead of 'main'
  import_role:
    name: myrole
    tasks_from: other
```

# ç‰¹å®šã®ãƒ­ãƒ¼ãƒ«ã«å«ã¾ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ã®å·®åˆ†ï¼ˆchangedï¼‰ã‚’å–å¾—ã—ãŸã„

taskå®Ÿè¡Œæ™‚ã®æƒ…å ±ã‚’`register`ã§å–å¾—ã§ããªã„ã‹è©¦ã—ã¦ã¿ã‚‹

```
- name: Run tasks/other.yaml instead of 'main'
  import_role:
    name: myrole
    tasks_from: other
  register: foo # fooã«taskå®Ÿè¡Œæ™‚ã®æƒ…å ±ã‚’æ ¼ç´ã—ã¦ã»ã—ã„

# ï¼ˆã“ã‚“ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§å®Ÿè¡Œã—ãŸã„ï¼‰
#- name: exec whoami
#  shell: whoami
#  register: foo

- name: debug message
  debug:
    msg: "{{ foo }}"
    #msg: "{{ foo.changed }}" # ã‚¿ã‚¤ãƒˆãƒ«çš„ã«ã¯ã“ã‚ŒãŒã»ã—ã„
```

# çµæœ
`foo is undefined`ã¨ãªã‚‹ã€‚`import_role`ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸroleå†…ã®taskã®æƒ…å ±ã¯å–å¾—ã§ããªã„

# ã¾ã¨ã‚
`import_role`ã‚’ç”¨ã„ã¦é–“æ¥çš„ã«taskã‚’å®Ÿè¡Œã—ãŸéš›ã«`changed`ã‚’ã‚‚ã¨ã«ã—ãŸå‡¦ç†ã®åˆ†å²ãŒã§ããªã„ã“ã¨ãŒã‚ã‹ã£ãŸ
